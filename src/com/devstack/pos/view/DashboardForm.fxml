<?xml version="1.0" encoding="UTF-8"?>

<?import com.jfoenix.controls.JFXButton?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.Cursor?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.MenuButton?>
<?import javafx.scene.control.MenuItem?>
<?import javafx.scene.control.ContextMenu?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.chart.XYChart?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.cell.PropertyValueFactory?>

<AnchorPane fx:id="context" xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.devstack.pos.controller.DashboardFormController"
            stylesheets="@styles/modern-dashboard.css"
            style="-fx-background-color: linear-gradient(to bottom right, #f4f4f9, #ffffff);">
   <children>

      <VBox prefWidth="250" spacing="20" styleClass="sidebar-light"
            AnchorPane.leftAnchor="0" AnchorPane.topAnchor="0" AnchorPane.bottomAnchor="0">
         <padding>
            <Insets top="25" right="15" bottom="30" left="15" />
         </padding>
         <children>
            <Text text="Kumara Enterprises" styleClass="sidebar-title-light" />
            <Separator style="-fx-max-width: 180; -fx-background-color: #DDDDDD;"/>
            <JFXButton fx:id="btnDashboard" text="ðŸ  Dashboard" onAction="#btnDashboardOnAction" styleClass="sidebar-btn-active-light" />
            <!-- Customer feature moved to Feature/customer-module branch -->
            <!-- <JFXButton fx:id="btnCustomer" text="ðŸ‘¥ Customers" onAction="#btnCustomerOnAction" styleClass="sidebar-btn-light" /> -->
            <JFXButton fx:id="btnProduct" text="ðŸ“¦ Products" onAction="#btnProductOnActions" styleClass="sidebar-btn-light" />
            <JFXButton fx:id="btnPlaceOrder" text="ðŸ›’ POS / Orders" onAction="#btnPlaceOrderOnAction" styleClass="sidebar-btn-light" />
            <!-- Pending payment feature moved to Feature/payment-method branch -->
            <!-- <JFXButton fx:id="btnPendingPayments" text="ðŸ’³ Pending Payments" onAction="#btnPendingPaymentsOnAction" styleClass="sidebar-btn-light" /> -->
            <JFXButton fx:id="btnReturns" text="ðŸ”„ Return Orders" onAction="#btnReturnsOrderOnAction" styleClass="sidebar-btn-light" />
            <JFXButton fx:id="btnPurchase" text="ðŸ’° Supplier" onAction="#btnPurchaseOnAction" styleClass="sidebar-btn-light" />
            <JFXButton fx:id="btnOrderDetails" text="ðŸ“‹ All Orders" onAction="#btnOrderDetailsOnAction" styleClass="sidebar-btn-light" />
            <JFXButton fx:id="btnReports" text="ðŸ“Š Reports" onAction="#btnIncomeReportOnAction" styleClass="sidebar-btn-light" />
            
            <Separator style="-fx-max-width: 190; -fx-background-color: #DDDDDD;"/>
            
            <JFXButton fx:id="btnHelp" text="â“ Help" onAction="#btnHelpOnAction" styleClass="sidebar-btn-light" />
            <JFXButton fx:id="btnAboutUs" text="â„¹ï¸ About Us" onAction="#btnAboutUsOnAction" styleClass="sidebar-btn-light" />
            
            <VBox VBox.vgrow="ALWAYS" />
         </children>
      </VBox>

      <VBox spacing="25" AnchorPane.leftAnchor="280" AnchorPane.rightAnchor="30"
            AnchorPane.topAnchor="30" AnchorPane.bottomAnchor="30">
         <children>
            <HBox alignment="CENTER_LEFT" spacing="20">
               <Text text="Executive Dashboard" styleClass="header-title-light"/>
               <Region HBox.hgrow="ALWAYS"/>
               <Text fx:id="lblWelcomeMessage" text="Welcome back!" styleClass="welcome-text-light"/>
               
               <!-- User Menu Button -->
               <MenuButton fx:id="btnUserMenu" text="ðŸ‘¤" styleClass="user-menu-button" style="-fx-font-size: 18px;  -fx-text-fill: white; -fx-background-radius: 20; -fx-padding: 2 6;">
                  <items>
                     <MenuItem fx:id="menuItemSettings" text="âš™ï¸ Settings" />
                     <MenuItem fx:id="menuItemLogout" text="ðŸšª Logout" />
                  </items>
                  <cursor>
                     <Cursor fx:constant="HAND" />
                  </cursor>
               </MenuButton>
            </HBox>

            <GridPane hgap="20">
               <columnConstraints>
                  <ColumnConstraints hgrow="ALWAYS"/>
                  <ColumnConstraints hgrow="ALWAYS"/>
                  <ColumnConstraints hgrow="ALWAYS"/>
               </columnConstraints>
               <VBox styleClass="kpi-card-light" GridPane.columnIndex="0">
                  <Text text="Today's Revenue" styleClass="kpi-label-light"/>
                  <Text fx:id="lblTodayRevenue" text="LKR 0.00" styleClass="kpi-value-primary"/>
                  <Text fx:id="lblRevenueChange" text="--" styleClass="kpi-change-positive"/>
               </VBox>
               <VBox styleClass="kpi-card-light" GridPane.columnIndex="1">
                  <Text text="Total Return Orders" styleClass="kpi-label-light"/>
                  <Text fx:id="returnOrderCount" text="0" styleClass="kpi-value-light"/>
<!--                  <Text fx:id="lblTotalProducts" text="Total Products: 0" styleClass="kpi-secondary-light"/>-->
               </VBox>
               <VBox styleClass="kpi-card-light" GridPane.columnIndex="2">
                  <Text text="Total Suppliers" styleClass="kpi-label-light"/>
                  <Text fx:id="lblTotalSuppliers" text="0" styleClass="kpi-value-light"/>
<!--                  <Text fx:id="lblTotalProducts" text="Total Products: 0" styleClass="kpi-secondary-light"/>-->
               </VBox>
               <!-- Pending payment feature moved to Feature/payment-method branch -->
               <!-- <VBox styleClass="kpi-card-light" GridPane.columnIndex="2">
                  <Text text="Pending Payments" styleClass="kpi-label-light"/>
                  <Text fx:id="lblPendingPaymentsCount" text="0" styleClass="kpi-value-light"/>
                  <Text fx:id="lblPendingPaymentsAmount" text="LKR 0.00" styleClass="kpi-secondary-light"/>
                  <Text fx:id="lblPendingPaymentsDetails" text="&#45;&#45;" styleClass="kpi-secondary-light" style="-fx-font-size: 11px;"/>
               </VBox> -->
            </GridPane>

            <HBox spacing="25" VBox.vgrow="ALWAYS">

               <VBox spacing="20" HBox.hgrow="ALWAYS">
                  <!-- Top Selling Products Chart -->
                  <VBox styleClass="chart-container-light" VBox.vgrow="ALWAYS">
                     <Text text="Top 20 Products (Current Month)" styleClass="chart-title-light"/>
                     <BarChart fx:id="barChartTopProducts" animated="true" legendVisible="false" VBox.vgrow="ALWAYS" styleClass="animated-pie-chart-light">
                        <xAxis>
                           <CategoryAxis fx:id="topProductsCategoryAxis" label="Product"/>
                        </xAxis>
                        <yAxis>
                           <NumberAxis fx:id="topProductsNumberAxis" label="Units Sold"/>
                        </yAxis>
                     </BarChart>
                  </VBox>
                  
                  <!-- Monthly Income Chart -->
                  <VBox styleClass="chart-container-light" VBox.vgrow="ALWAYS">
                     <Text text="Monthly Total Income (Current Month)" styleClass="chart-title-light"/>
                     <BarChart fx:id="barChartMonthlyIncome" animated="true" VBox.vgrow="ALWAYS" styleClass="animated-pie-chart-light">
                        <xAxis>
                           <CategoryAxis fx:id="categoryAxis" label="Day" />
                        </xAxis>
                        <yAxis>
                           <NumberAxis fx:id="numberAxis" label="Income (LKR)" />
                        </yAxis>
                     </BarChart>
                  </VBox>
               </VBox>

               <VBox prefWidth="380" spacing="20">

                  <!-- Quick Stats Summary -->
                  <GridPane hgap="15" vgap="15">
                     <columnConstraints>
                        <ColumnConstraints hgrow="ALWAYS" prefWidth="180"/>
                        <ColumnConstraints hgrow="ALWAYS" prefWidth="180"/>
                     </columnConstraints>
                     
                     <!-- Today's Orders -->
                     <VBox styleClass="summary-card-blue" GridPane.columnIndex="0" GridPane.rowIndex="0">
                        <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                        <Text text="ðŸ“¦ Today's Orders" style="-fx-font-size: 13px; -fx-fill: #64748b; -fx-font-weight: bold;"/>
                        <Text fx:id="lblTodayOrders" text="0" style="-fx-font-size: 20px; -fx-fill: #0ea5e9; -fx-font-weight: bold;"/>
                        <Text fx:id="lblOrdersChange" text="--" style="-fx-font-size: 11px; -fx-fill: #94a3b8;"/>
                     </VBox>
                     
                     <!-- Average Order Value -->
                     <VBox styleClass="summary-card-green" GridPane.columnIndex="1" GridPane.rowIndex="0">
                        <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                        <Text text="ðŸ’° Avg Order Value" style="-fx-font-size: 13px; -fx-fill: #64748b; -fx-font-weight: bold;"/>
                        <Text fx:id="lblAvgOrderValue" text="LKR 0.00" style="-fx-font-size: 20px; -fx-fill: #10b981; -fx-font-weight: bold;"/>
                        <Text text="Per transaction" style="-fx-font-size: 11px; -fx-fill: #94a3b8;"/>
                     </VBox>
                     
                     <!-- Total Products -->
                     <VBox styleClass="summary-card-purple" GridPane.columnIndex="0" GridPane.rowIndex="1">
                        <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                        <Text text="ðŸ“¦ Total Products" style="-fx-font-size: 13px; -fx-fill: #64748b; -fx-font-weight: bold;"/>
                        <Text fx:id="lblTotalProductsCount" text="0" style="-fx-font-size: 24px; -fx-fill: #8b5cf6; -fx-font-weight: bold;"/>
                        <Text fx:id="lblActiveProducts" text="Active products" style="-fx-font-size: 11px; -fx-fill: #94a3b8;"/>
                     </VBox>
                     
                     <!-- Low Stock Alert -->
                     <VBox styleClass="summary-card-orange" GridPane.columnIndex="1" GridPane.rowIndex="1" onMouseClicked="#onLowStockCardClicked">
                        <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                        <cursor>
                           <Cursor fx:constant="HAND"/>
                        </cursor>
                        <Text text="âš ï¸ Low Stock Items" style="-fx-font-size: 13px; -fx-fill: #64748b; -fx-font-weight: bold;"/>
                        <Text fx:id="lblLowStockCount" text="0" style="-fx-font-size: 28px; -fx-fill: #f59e0b; -fx-font-weight: bold;"/>
                        <Text text="Need attention" style="-fx-font-size: 11px; -fx-fill: #94a3b8;"/>
                     </VBox>
                  </GridPane>

                  <!-- Recent Transactions -->
<!--                  <VBox styleClass="chart-container-light" VBox.vgrow="ALWAYS">-->
                     <Text text="Recent Transactions" styleClass="chart-title-light"/>
                     <TableView fx:id="tblRecentTransactions" styleClass="table-view-modern" VBox.vgrow="ALWAYS">
                        <columns>
                           <TableColumn text="Customer" prefWidth="110">
                              <cellValueFactory>
                                 <PropertyValueFactory property="customerName"/>
                              </cellValueFactory>
                           </TableColumn>
                           <TableColumn text="Amount" prefWidth="135">
                              <cellValueFactory>
                                 <PropertyValueFactory property="amount"/>
                              </cellValueFactory>
                           </TableColumn>
<!--                           <TableColumn text="Discount" prefWidth="100">-->
<!--                              <cellValueFactory>-->
<!--                                 <PropertyValueFactory property="discount"/>-->
<!--                              </cellValueFactory>-->
<!--                           </TableColumn>-->
                           <TableColumn text="Date &amp; Time" prefWidth="145">
                              <cellValueFactory>
                                 <PropertyValueFactory property="date"/>
                              </cellValueFactory>
                           </TableColumn>
                        </columns>
                     </TableView>
<!--                  </VBox>-->

               </VBox>
            </HBox>

         </children>
      </VBox>
   </children>
</AnchorPane>